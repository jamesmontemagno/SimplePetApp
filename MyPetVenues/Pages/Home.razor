@page "/"
@inject IVenueService VenueService
@inject IReviewService ReviewService

<PageTitle>MyPetVenues - Find Pet-Friendly Places 🐾</PageTitle>

<!-- Hero Section -->
<section class="hero">
    <div class="hero-content">
        <h1>Find the <span class="hero-emoji">🐾</span> Perfect Place for You & Your Pet</h1>
        <p>Discover amazing pet-friendly venues, parks, cafés, hotels, and more in your area! 🐕🐈🐰</p>
        <div class="hero-search">
            <input type="text" @bind="searchTerm" @bind:event="oninput" placeholder="🔍 Search venues, cities, or activities..." />
            <a href="@GetSearchUrl()" class="btn btn-primary">Search</a>
        </div>
        <div class="hero-features">
            <div class="hero-feature">
                <span class="hero-feature-icon">📍</span>
                <span>@venueCount+ Venues</span>
            </div>
            <div class="hero-feature">
                <span class="hero-feature-icon">⭐</span>
                <span>@reviewCount+ Reviews</span>
            </div>
            <div class="hero-feature">
                <span class="hero-feature-icon">🐾</span>
                <span>All Pet Types</span>
            </div>
        </div>
    </div>
</section>

<!-- Category Navigation -->
<section class="categories">
    <div class="container">
        <h2>🗺️ Browse by Category</h2>
        <p class="categories-subtitle">Find the perfect spot for your next adventure with your furry friend!</p>
        <div class="category-grid">
            <a href="/venues?type=Park" class="category-card">
                <span class="category-icon">🌳</span>
                <span class="category-name">Parks</span>
            </a>
            <a href="/venues?type=Cafe" class="category-card">
                <span class="category-icon">☕</span>
                <span class="category-name">Cafés</span>
            </a>
            <a href="/venues?type=Restaurant" class="category-card">
                <span class="category-icon">🍽️</span>
                <span class="category-name">Restaurants</span>
            </a>
            <a href="/venues?type=Hotel" class="category-card">
                <span class="category-icon">🏨</span>
                <span class="category-name">Hotels</span>
            </a>
            <a href="/venues?type=Store" class="category-card">
                <span class="category-icon">🛍️</span>
                <span class="category-name">Pet Stores</span>
            </a>
            <a href="/venues?type=Beach" class="category-card">
                <span class="category-icon">🏖️</span>
                <span class="category-name">Beaches</span>
            </a>
            <a href="/venues?type=Trail" class="category-card">
                <span class="category-icon">🥾</span>
                <span class="category-name">Trails</span>
            </a>
            <a href="/venues?type=Veterinary" class="category-card">
                <span class="category-icon">🏥</span>
                <span class="category-name">Veterinary</span>
            </a>
        </div>
    </div>
</section>

<!-- Key Features Section -->
<section class="features-section">
    <div class="container">
        <h2>✨ Why Choose MyPetVenues?</h2>
        <p class="features-subtitle">Everything you need to find pet-friendly places!</p>
        <div class="features-grid">
            <div class="feature-card">
                <span class="feature-icon">🔍</span>
                <h3>Easy Discovery</h3>
                <p>Search and filter venues by type, pet type, amenities, and location. Find exactly what you and your pet need!</p>
            </div>
            <div class="feature-card">
                <span class="feature-icon">⭐</span>
                <h3>Real Reviews</h3>
                <p>Read honest reviews from fellow pet owners. Know what to expect before you visit!</p>
            </div>
            <div class="feature-card">
                <span class="feature-icon">🐾</span>
                <h3>All Pets Welcome</h3>
                <p>Dogs, cats, birds, rabbits, and more! Find venues that welcome your specific type of pet.</p>
            </div>
            <div class="feature-card">
                <span class="feature-icon">📍</span>
                <h3>Detailed Info</h3>
                <p>Get complete venue details including amenities, hours, contact info, and photos!</p>
            </div>
        </div>
    </div>
</section>

<!-- Featured Venues -->
<section class="featured-venues">
    <div class="container">
        <div class="section-header">
            <h2><span class="section-emoji">🌟</span> Featured Pet-Friendly Venues</h2>
            <a href="/venues" class="view-all">View All →</a>
        </div>
        @if (featuredVenues == null)
        {
            <div class="loading">✨ Loading amazing venues...</div>
        }
        else
        {
            <div class="venue-grid">
                @foreach (var venue in featuredVenues)
                {
                    <a href="/venue/@venue.Id" class="venue-card">
                        <div class="venue-image">
                            <img src="@venue.ImageUrl" alt="@venue.Name" loading="lazy" />
                            <div class="venue-image-overlay"></div>
                            <span class="venue-type-badge">@GetVenueTypeEmoji(venue.Type) @venue.Type</span>
                        </div>
                        <div class="venue-info">
                            <h3>@venue.Name</h3>
                            <p class="venue-location">📍 @venue.City, @venue.State</p>
                            <div class="venue-meta">
                                <span class="venue-rating">
                                    @GetStarRating(venue.AverageRating)
                                    <span class="rating-value">@venue.AverageRating.ToString("0.0")</span>
                                    <span class="review-count">(@venue.ReviewCount)</span>
                                </span>
                            </div>
                            <div class="pet-types">
                                @foreach (var pet in venue.AcceptedPetTypes.Take(3))
                                {
                                    <span class="pet-badge" title="@pet">@GetPetTypeEmoji(pet)</span>
                                }
                                @if (venue.AcceptedPetTypes.Count > 3)
                                {
                                    <span class="pet-badge">+@(venue.AcceptedPetTypes.Count - 3)</span>
                                }
                            </div>
                        </div>
                    </a>
                }
            </div>
        }
    </div>
</section>

<!-- Pet Showcase -->
<section class="pets-showcase">
    <div class="container">
        <h2>🐾 Meet Our Pet Community</h2>
        <div class="pets-scroll">
            <div class="pet-showcase-card">
                <img src="images/pets/dog1.png" alt="Happy Dog" />
                <span>Max 🐕</span>
            </div>
            <div class="pet-showcase-card">
                <img src="images/pets/cat1.jpg" alt="Cute Cat" />
                <span>Whiskers 🐈</span>
            </div>
            <div class="pet-showcase-card">
                <img src="images/pets/dog3.jpg" alt="Friendly Dog" />
                <span>Buddy 🐕</span>
            </div>
            <div class="pet-showcase-card">
                <img src="images/pets/cat2.jpg" alt="Sweet Cat" />
                <span>Luna 🐈</span>
            </div>
            <div class="pet-showcase-card">
                <img src="images/pets/bunny.jpg" alt="Cute Bunny" />
                <span>Hoppy 🐰</span>
            </div>
            <div class="pet-showcase-card">
                <img src="images/pets/dog4.png" alt="Playful Dog" />
                <span>Bella 🐕</span>
            </div>
            <div class="pet-showcase-card">
                <img src="images/pets/cat3.jpg" alt="Lovely Cat" />
                <span>Shadow 🐈</span>
            </div>
            <div class="pet-showcase-card">
                <img src="images/pets/dog5.jpg" alt="Happy Pup" />
                <span>Charlie 🐕</span>
            </div>
            <!-- Duplicate for seamless scroll -->
            <div class="pet-showcase-card">
                <img src="images/pets/dog1.png" alt="Happy Dog" />
                <span>Max 🐕</span>
            </div>
            <div class="pet-showcase-card">
                <img src="images/pets/cat1.jpg" alt="Cute Cat" />
                <span>Whiskers 🐈</span>
            </div>
            <div class="pet-showcase-card">
                <img src="images/pets/dog3.jpg" alt="Friendly Dog" />
                <span>Buddy 🐕</span>
            </div>
            <div class="pet-showcase-card">
                <img src="images/pets/cat2.jpg" alt="Sweet Cat" />
                <span>Luna 🐈</span>
            </div>
        </div>
    </div>
</section>

<!-- Recent Reviews -->
<section class="recent-reviews">
    <div class="container">
        <h2>💬 What Pet Owners Are Saying</h2>
        <p class="reviews-subtitle">Real reviews from our amazing pet parent community!</p>
        @if (recentReviews == null)
        {
            <div class="loading">✨ Loading reviews...</div>
        }
        else
        {
            <div class="reviews-grid">
                @foreach (var review in recentReviews)
                {
                    <div class="review-card">
                        <div class="review-header">
                            <img src="@review.PetImageUrl" alt="@review.PetName" class="pet-avatar" />
                            <div class="review-meta">
                                <span class="reviewer-name">@review.ReviewerName</span>
                                <span class="review-rating">@GetStarRating(review.Rating)</span>
                            </div>
                        </div>
                        <p class="review-comment">"@TruncateText(review.Comment, 120)"</p>
                        <div class="review-footer">
                            <span class="pet-info">🐾 @review.PetName (@review.PetType)</span>
                            <span class="review-date">@GetRelativeTime(review.DatePosted)</span>
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</section>

<!-- Call to Action -->
<section class="cta-section">
    <div class="container">
        <div class="cta-content">
            <h2>🌟 Know a Great Pet-Friendly Spot?</h2>
            <p>Help fellow pet owners discover amazing venues by adding your favorite places! Share the love! 💖</p>
            <a href="/add-venue" class="btn">➕ Add a Venue</a>
        </div>
    </div>
</section>

@code {
    private List<Venue>? featuredVenues;
    private List<Review>? recentReviews;
    private string searchTerm = "";
    private int venueCount = 0;
    private int reviewCount = 0;

    protected override async Task OnInitializedAsync()
    {
        featuredVenues = await VenueService.GetFeaturedVenuesAsync(6);
        recentReviews = await ReviewService.GetRecentReviewsAsync(4);
        
        // Get total counts for display
        var allVenues = await VenueService.GetVenuesAsync();
        venueCount = allVenues?.Count ?? 0;
        reviewCount = allVenues?.Sum(v => v.ReviewCount) ?? 0;
    }

    private string GetSearchUrl()
    {
        if (string.IsNullOrWhiteSpace(searchTerm))
            return "/venues";
        return $"/venues?search={Uri.EscapeDataString(searchTerm)}";
    }

    private string GetStarRating(decimal rating)
    {
        int fullStars = (int)rating;
        bool halfStar = rating - fullStars >= 0.5m;
        var stars = new string('★', fullStars);
        if (halfStar) stars += "½";
        stars += new string('☆', 5 - fullStars - (halfStar ? 1 : 0));
        return stars;
    }

    private string GetStarRating(int rating)
    {
        return new string('★', rating) + new string('☆', 5 - rating);
    }

    private string GetVenueTypeEmoji(VenueType type) => type switch
    {
        VenueType.Park => "🌳",
        VenueType.Cafe => "☕",
        VenueType.Restaurant => "🍽️",
        VenueType.Hotel => "🏨",
        VenueType.Store => "🛍️",
        VenueType.Home => "🏠",
        VenueType.Beach => "🏖️",
        VenueType.Trail => "🥾",
        VenueType.Veterinary => "🏥",
        VenueType.Grooming => "✂️",
        _ => "📍"
    };

    private string GetPetTypeEmoji(PetType type) => type switch
    {
        PetType.Dog => "🐕",
        PetType.Cat => "🐈",
        PetType.Bird => "🐦",
        PetType.Rabbit => "🐰",
        PetType.Reptile => "🦎",
        PetType.Fish => "🐟",
        PetType.SmallMammal => "🐹",
        _ => "🐾"
    };

    private string TruncateText(string text, int maxLength)
    {
        if (text.Length <= maxLength) return text;
        return text.Substring(0, maxLength).TrimEnd() + "...";
    }

    private string GetRelativeTime(DateTime date)
    {
        var span = DateTime.Now - date;
        if (span.TotalDays < 1) return "Today";
        if (span.TotalDays < 2) return "Yesterday";
        if (span.TotalDays < 7) return $"{(int)span.TotalDays} days ago";
        if (span.TotalDays < 30) return $"{(int)(span.TotalDays / 7)} weeks ago";
        return $"{(int)(span.TotalDays / 30)} months ago";
    }
}
