@page "/pet/{Id:int}"
@using MyPetVenues.Models
@using MyPetVenues.Services
@inject MockDataService DataService
@inject NavigationManager Navigation

<PageTitle>@(pet?.Name ?? "Pet") - PawSpots</PageTitle>

<link rel="stylesheet" href="../css/pet-detail.css" />

@if (pet == null)
{
    <div class="loading-container">
        <div class="loading-spinner">üêæ</div>
        <p>Loading pet profile...</p>
    </div>
}
else
{
    <div class="pet-detail-container">
        <!-- Back Button -->
        <button class="back-button" @onclick="NavigateBack">
            ‚Üê Back to Pets
        </button>

        <!-- Pet Profile Header -->
        <div class="pet-profile-header">
            <div class="pet-profile-image">
                <img src="../@pet.ImageUrl" alt="@pet.Name" />
                <div class="pet-type-icon">@GetPetTypeIcon(pet.Type)</div>
            </div>
            <div class="pet-profile-info">
                <h1 class="pet-name-large">@pet.Name</h1>
                <p class="pet-breed-large">@pet.Breed</p>
                
                <div class="pet-stats">
                    <div class="stat-item">
                        <span class="stat-icon">üéÇ</span>
                        <div class="stat-content">
                            <span class="stat-label">Age</span>
                            <span class="stat-value">@pet.Age @(pet.Age == 1 ? "year" : "years") old</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">üìè</span>
                        <div class="stat-content">
                            <span class="stat-label">Size</span>
                            <span class="stat-value">@pet.Size</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">‚öß</span>
                        <div class="stat-content">
                            <span class="stat-label">Size</span>
                            <span class="stat-value">@pet.Size</span>
                        </div>
                    </div>
                </div>

                <div class="owner-info">
                    <span class="owner-icon">üë§</span>
                    <span class="owner-name">Owner: <strong>@pet.OwnerName</strong></span>
                </div>
            </div>
        </div>

        <!-- Pet Details Content -->
        <div class="pet-content">
            <!-- About -->
            <section class="content-section">
                <h2 class="section-title">üìù About @pet.Name</h2>
                <p class="pet-bio">@pet.Bio</p>
            </section>

            <!-- Personality -->
            <section class="content-section">
                <h2 class="section-title">‚ú® Personality Traits</h2>
                <div class="personality-grid">
                    @foreach (var trait in pet.Personality)
                    {
                        <div class="personality-item">
                            @GetPersonalityIcon(trait) @trait
                        </div>
                    }
                </div>
            </section>

            <!-- Favorite Places -->
            @if (pet.FavoriteVenues.Any())
            {
                <section class="content-section">
                    <h2 class="section-title">‚ù§Ô∏è Favorite Places</h2>
                    <div class="favorite-places">
                        @foreach (var place in pet.FavoriteVenues)
                        {
                            <div class="favorite-place-item">
                                <span class="place-icon">üìç</span>
                                <span class="place-name">@place</span>
                            </div>
                        }
                    </div>
                </section>
            }
        </div>
    </div>
}

@code {
    [Parameter]
    public int Id { get; set; }

    private Pet? pet;

    protected override async Task OnInitializedAsync()
    {
        var pets = await DataService.GetPetsAsync();
        pet = pets.FirstOrDefault(p => p.Id == Id);
    }

    private void NavigateBack()
    {
        Navigation.NavigateTo("/");
    }

    private string GetPetTypeIcon(PetType type)
    {
        return type switch
        {
            PetType.Dogs => "üêï",
            PetType.Cats => "üêà",
            PetType.Birds => "ü¶ú",
            PetType.SmallAnimals => "üê∞",
            _ => "üêæ"
        };
    }

    private string GetPersonalityIcon(string trait)
    {
        return trait.ToLower() switch
        {
            var t when t.Contains("friendly") => "üòä",
            var t when t.Contains("playful") => "üéæ",
            var t when t.Contains("energetic") => "‚ö°",
            var t when t.Contains("calm") => "üòå",
            var t when t.Contains("shy") => "üôà",
            var t when t.Contains("brave") => "üí™",
            var t when t.Contains("curious") => "üîç",
            var t when t.Contains("gentle") => "ü§ó",
            var t when t.Contains("social") => "üë•",
            var t when t.Contains("loyal") => "‚ù§Ô∏è",
            var t when t.Contains("smart") => "üß†",
            var t when t.Contains("affectionate") => "üíï",
            _ => "‚ú®"
        };
    }
}
