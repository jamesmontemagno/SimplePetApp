@using MyPetVenues.Models

<div class="venue-card" @onclick="NavigateToVenue">
    <div class="venue-card-image">
        <img src="@Venue.ImageUrl" alt="@Venue.Name" loading="lazy" />
        <div class="venue-card-type">@GetVenueTypeIcon() @Venue.Type</div>
    </div>
    
    <div class="venue-card-content">
        <h3 class="venue-card-title">@Venue.Name</h3>
        
        <div class="venue-card-rating">
            <StarRating Rating="@Venue.Rating" ShowCount="true" Count="@Venue.ReviewCount" />
        </div>
        
        <p class="venue-card-description">@TruncateDescription(Venue.Description)</p>
        
        <div class="venue-card-pets">
            @foreach (var petType in Venue.AllowedPets.Take(3))
            {
                <span class="pet-badge">@GetPetEmoji(petType) @petType</span>
            }
            @if (Venue.AllowedPets.Count > 3)
            {
                <span class="pet-badge-more">+@(Venue.AllowedPets.Count - 3) more</span>
            }
        </div>
        
        @if (Venue.Amenities.Any())
        {
            <div class="venue-card-amenities">
                @foreach (var amenity in Venue.Amenities.Take(4))
                {
                    <span class="amenity-badge" title="@amenity.Name">@amenity.Icon</span>
                }
                @if (Venue.Amenities.Count > 4)
                {
                    <span class="amenity-badge-more">+@(Venue.Amenities.Count - 4)</span>
                }
            </div>
        }
        
        <div class="venue-card-footer">
            <span class="venue-card-address">üìç @GetShortAddress()</span>
        </div>
    </div>
</div>

@code {
    [Parameter, EditorRequired]
    public Venue Venue { get; set; } = null!;
    
    [Inject]
    private NavigationManager Navigation { get; set; } = null!;
    
    private void NavigateToVenue()
    {
        Navigation.NavigateTo($"/venues/{Venue.Id}");
    }
    
    private string TruncateDescription(string description)
    {
        const int maxLength = 100;
        if (description.Length <= maxLength)
            return description;
        
        return description.Substring(0, maxLength) + "...";
    }
    
    private string GetShortAddress()
    {
        var parts = Venue.Address.Split(',');
        return parts.Length > 0 ? parts[0].Trim() : Venue.Address;
    }
    
    private string GetVenueTypeIcon()
    {
        return Venue.Type switch
        {
            VenueType.Park => "üå≥",
            VenueType.Cafe => "‚òï",
            VenueType.Store => "üè™",
            VenueType.Hotel => "üè®",
            VenueType.Clinic => "‚öïÔ∏è",
            VenueType.Restaurant => "üçΩÔ∏è",
            VenueType.Beach => "üèñÔ∏è",
            VenueType.Trail => "ü•æ",
            _ => "üìç"
        };
    }
    
    private string GetPetEmoji(PetType petType)
    {
        return petType switch
        {
            PetType.Dog => "üêï",
            PetType.Cat => "üêà",
            PetType.Rabbit => "üê∞",
            PetType.Bird => "ü¶ú",
            PetType.Hamster => "üêπ",
            PetType.GuineaPig => "üêπ",
            PetType.Hedgehog => "ü¶î",
            PetType.Reptile => "ü¶é",
            PetType.Fish => "üê†",
            _ => "üêæ"
        };
    }
}
